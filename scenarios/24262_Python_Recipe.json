{
  "projectKey": "EVERYTHING",
  "id": "24262_Python_Recipe",
  "type": "step_based",
  "name": "24262 Python Recipe",
  "active": false,
  "runAsUser": "test",
  "versionTag": {
    "versionNumber": 112,
    "lastModifiedBy": {
      "login": "admin"
    },
    "lastModifiedOn": 1646436872698
  },
  "checklists": {
    "checklists": []
  },
  "delayedTriggersBehavior": {
    "delayWhileRunning": true,
    "squashDelayedTriggers": true,
    "suppressTriggersWhileRunning": true
  },
  "tags": [],
  "triggers": [
    {
      "id": "GBv7ChIN",
      "type": "temporal",
      "name": "Time-based",
      "delay": 5,
      "active": false,
      "params": {
        "repeatFrequency": 1,
        "frequency": "Monthly",
        "startingFrom": "2022-01-07T00:38:00.000Z",
        "daysOfWeek": [
          "Friday"
        ],
        "monthlyRunOn": "FIRST_WEEK",
        "minute": 38,
        "hour": 9,
        "timezone": "SERVER"
      }
    },
    {
      "id": "izYgh46u",
      "type": "custom_python",
      "name": "Custom trigger",
      "delay": 15,
      "active": true,
      "params": {
        "code": "from dataiku.scenario import Trigger\nimport dataiku\nimport pandas as pd, numpy as np\nfrom dataiku import pandasutils as pdu\nrun \u003d dataiku.Dataset(\"run\")\nrun_df \u003d run.get_dataframe()\nt \u003d Trigger()\nif run_df[\u0027line\u0027].values[0] \u003d\u003d \u00272017-01-01\u0027:\n    t.fire()",
        "envSelection": {
          "envMode": "INHERIT"
        }
      },
      "graceDelaySettings": {
        "delay": 0,
        "checkAgainAfterGraceDelay": false
      }
    }
  ],
  "reporters": [
    {
      "active": false,
      "messaging": {
        "type": "dataset-scenario",
        "configuration": {
          "projectKey": "EVERYTHING",
          "datasetName": "aaa123",
          "message": "{\n\t\"col1\":\"${RecordCount}\",\n\t\"col2\":\"${triggerType}\"\n}"
        }
      },
      "id": "9fHsyGWU",
      "name": "send to dataset test",
      "runConditionEnabled": true,
      "runCondition": "outcome \u003d\u003d \u0027FAIL\u0027",
      "phase": "START",
      "variablesCode": "import json\n\n\n\n# compute your additional variables from the list of report items \n# and return them as a dictionary.\ndef get_variables(items_json, scenario_run_json, step_run_output_json):\n    with open(\"/Users/rendo/Library/DataScienceStudio/dss_home/config/projects/EVERYTHING/variables.json\") as json_file:\n        data \u003d json.load(json_file)\n        print(data)\n    return {\"RecordCount\" : data[\u0027month\u0027]}"
    },
    {
      "active": false,
      "messaging": {
        "type": "mail-scenario",
        "configuration": {
          "channelId": "my_smtp",
          "subject": "DSS scenario ${scenarioName}: ${RecordCount}",
          "recipient": "roy.endo@dataiku.com",
          "sendAsHTML": false,
          "attachments": [],
          "messageSource": "TEMPLATE_FILE",
          "templateFormat": "FREEMARKER",
          "templateName": "default.ftl"
        }
      },
      "id": "o930LDEO",
      "runConditionEnabled": true,
      "runCondition": "outcome\u003d\u003d\"FAIL\"",
      "phase": "END",
      "variablesCode": "import json\n\n# compute your additional variables from the list of report items \n# and return them as a dictionary.\ndef get_variables(items_json, scenario_run_json, step_run_output_json):\n    with open(\"/Users/rendo/Library/DataScienceStudio/dss_home/config/projects/EVERYTHING/variables.json\") as json_file:\n        data \u003d json.load(json_file)\n        print(data)\n    return {\"RecordCount\" : data[\u0027recordCount\u0027]}"
    }
  ],
  "params": {
    "steps": [
      {
        "id": "build_0_true_d_2_prepared_scored",
        "type": "build_flowitem",
        "name": "Step #4",
        "runConditionType": "DISABLED",
        "runConditionStatuses": [
          "SUCCESS",
          "WARNING"
        ],
        "runConditionExpression": "",
        "resetScenarioStatus": false,
        "delayBetweenRetries": 10,
        "maxRetriesOnFail": 0,
        "params": {
          "builds": [
            {
              "type": "DATASET",
              "itemId": "2_prepared_scored",
              "partitionsSpec": ""
            }
          ],
          "jobType": "RECURSIVE_BUILD",
          "refreshHiveMetastore": true,
          "proceedOnFailure": false
        }
      },
      {
        "id": "run_scenario_null.Admin_Training",
        "type": "run_scenario",
        "name": "Step #1",
        "runConditionType": "DISABLED",
        "runConditionStatuses": [
          "SUCCESS",
          "WARNING"
        ],
        "runConditionExpression": "",
        "resetScenarioStatus": false,
        "delayBetweenRetries": 10,
        "maxRetriesOnFail": 0,
        "params": {
          "scenarioId": "Admin_Training",
          "proceedOnFailure": true
        }
      },
      {
        "id": "run_scenario_null.null",
        "type": "run_scenario",
        "name": "Step #2",
        "runConditionType": "DISABLED",
        "runConditionStatuses": [
          "SUCCESS",
          "WARNING"
        ],
        "runConditionExpression": "",
        "resetScenarioStatus": false,
        "delayBetweenRetries": 10,
        "maxRetriesOnFail": 0,
        "params": {
          "scenarioId": "24811",
          "proceedOnFailure": true
        }
      },
      {
        "id": "run_scenario_null.null_1",
        "type": "run_scenario",
        "name": "Step #3",
        "runConditionType": "DISABLED",
        "runConditionStatuses": [
          "SUCCESS",
          "WARNING"
        ],
        "runConditionExpression": "",
        "resetScenarioStatus": false,
        "delayBetweenRetries": 10,
        "maxRetriesOnFail": 0,
        "params": {
          "scenarioId": "Aa",
          "proceedOnFailure": true
        }
      },
      {
        "id": "build_0_true_d_paritionined_prepared_copy",
        "type": "build_flowitem",
        "name": "asd",
        "runConditionType": "RUN_IF_STATUS_MATCH",
        "runConditionStatuses": [
          "SUCCESS",
          "WARNING"
        ],
        "runConditionExpression": "",
        "resetScenarioStatus": false,
        "delayBetweenRetries": 10,
        "maxRetriesOnFail": 0,
        "params": {
          "builds": [
            {
              "type": "DATASET",
              "itemId": "paritionined_prepared_copy",
              "partitionsSpec": "2020,2022"
            }
          ],
          "jobType": "NON_RECURSIVE_FORCED_BUILD",
          "refreshHiveMetastore": true,
          "proceedOnFailure": false
        }
      }
    ]
  },
  "automationLocal": false,
  "customFields": {}
}